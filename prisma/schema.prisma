generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ===========================================
// USERS & AUTHENTICATION
// ===========================================

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  username     String   @unique
  passwordHash String
  firstName    String?
  lastName     String?
  avatar       String?
  role         String   @default("USER")
  status       String   @default("ACTIVE")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  blogPosts    BlogPost[]
  jobPostings  JobPosting[]
  whitepapers  Whitepaper[]
  guides       DeveloperGuide[]
  changelogs   Changelog[]
  mediaFiles   MediaFile[]

  @@map("users")
}

// ===========================================
// BLOG MANAGEMENT
// ===========================================

model BlogPost {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  excerpt     String?
  content     String
  coverImage  String?
  status      String   @default("DRAFT")
  publishedAt DateTime?
  scheduledAt DateTime?
  views       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  authorId String
  author   User @relation(fields: [authorId], references: [id], onDelete: Cascade)

  tags     BlogPostTag[]
  seo      SeoMeta?
  comments Comment[]
}

model BlogPostTag {
  id     String @id @default(cuid())
  postId String
  tagId  String

  post BlogPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag  Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([postId, tagId])
}

model Tag {
  id             String          @id @default(cuid())
  name           String          @unique
  slug           String          @unique
  color          String?
  posts          BlogPostTag[]
  whitepaperTags WhitepaperTag[]
  guideTags      GuideTag[]
}

// ===========================================
// CAREERS MANAGEMENT
// ===========================================

model JobPosting {
  id            String   @id @default(cuid())
  title         String
  slug          String   @unique
  department    String
  location      String
  type          String   @default("FULL_TIME")
  experience    String?
  salary        String?
  description   String
  requirements  String?
  benefits      String?
  status        String   @default("OPEN")
  priority      String   @default("NORMAL")
  publishedAt   DateTime?
  closesAt      DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  authorId String
  author   User @relation(fields: [authorId], references: [id], onDelete: Cascade)

  seo SeoMeta?
}

// ===========================================
// CHANGELOG MANAGEMENT
// ===========================================

model Changelog {
  id          String   @id @default(cuid())
  version     String
  title       String
  description String?
  type        String   @default("MINOR")
  status      String   @default("DRAFT")
  publishedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  authorId String
  author   User @relation(fields: [authorId], references: [id], onDelete: Cascade)

  changes ChangelogChange[]
  seo     SeoMeta?
}

model ChangelogChange {
  id          String    @id @default(cuid())
  changelogId String
  type        String
  description String
  order       Int       @default(0)

  changelog Changelog @relation(fields: [changelogId], references: [id], onDelete: Cascade)
}

// ===========================================
// WHITEPAPERS & GUIDES
// ===========================================

model Whitepaper {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  abstract    String?
  category    String
  version     String   @default("1.0")
  fileUrl     String?
  fileSize    Int?
  fileType    String?
  status      String   @default("DRAFT")
  publishedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  authorId String
  author   User @relation(fields: [authorId], references: [id], onDelete: Cascade)

  tags WhitepaperTag[]
  seo  SeoMeta?
}

model WhitepaperTag {
  id           String      @id @default(cuid())
  whitepaperId String
  tagId        String

  whitepaper Whitepaper @relation(fields: [whitepaperId], references: [id], onDelete: Cascade)
  tag        Tag        @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([whitepaperId, tagId])
}

model DeveloperGuide {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  path        String   @unique
  category    String
  content     String
  order       Int      @default(0)
  status      String   @default("DRAFT")
  publishedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  authorId String
  author   User @relation(fields: [authorId], references: [id], onDelete: Cascade)

  tags GuideTag[]
  seo  SeoMeta?
}

model GuideTag {
  id      String @id @default(cuid())
  guideId String
  tagId   String

  guide DeveloperGuide @relation(fields: [guideId], references: [id], onDelete: Cascade)
  tag   Tag           @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([guideId, tagId])
}

// ===========================================
// MEDIA LIBRARY
// ===========================================

model MediaFile {
  id           String   @id @default(cuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  width        Int?
  height       Int?
  path         String
  url          String
  alt          String?
  category     String   @default("IMAGE")
  uploadedBy   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  uploaderId String?
  uploader   User? @relation(fields: [uploaderId], references: [id], onDelete: SetNull)

  tags MediaFileTag[]
}

model MediaFileTag {
  id          String     @id @default(cuid())
  mediaFileId String
  tag         String

  mediaFile MediaFile @relation(fields: [mediaFileId], references: [id], onDelete: Cascade)
}

// ===========================================
// SEO METADATA
// ===========================================

model SeoMeta {
  id          String   @id @default(cuid())
  title       String?
  description String?
  keywords    String?
  ogImage     String?
  canonical   String?
  robots      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  blogPostId    String? @unique
  jobPostingId  String? @unique
  changelogId   String? @unique
  whitepaperId  String? @unique
  guideId       String? @unique

  blogPost   BlogPost?      @relation(fields: [blogPostId], references: [id], onDelete: Cascade)
  jobPosting JobPosting?    @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
  changelog  Changelog?     @relation(fields: [changelogId], references: [id], onDelete: Cascade)
  whitepaper Whitepaper?    @relation(fields: [whitepaperId], references: [id], onDelete: Cascade)
  guide      DeveloperGuide? @relation(fields: [guideId], references: [id], onDelete: Cascade)
}

// ===========================================
// ADMIN SETTINGS & CONFIGURATION
// ===========================================

model AdminSetting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  description String?
  category    String
  updatedAt   DateTime @updatedAt
}

// ===========================================
// SYSTEM LOGS
// ===========================================

model SystemLog {
  id        String   @id @default(cuid())
  level     String   @default("INFO")
  message   String
  context   String?  // JSON stored as text
  userId    String?
  createdAt DateTime @default(now())
}

// ===========================================
// ANALYTICS & STATISTICS
// ===========================================

model PageView {
  id        String   @id @default(cuid())
  path      String
  title     String?
  referrer  String?
  userAgent String?
  ip        String?
  userId    String?
  createdAt DateTime @default(now())
}

model ContentAnalytics {
  id          String   @id @default(cuid())
  contentType String
  contentId   String
  views       Int      @default(0)
  uniqueViews Int      @default(0)
  shares      Int      @default(0)
  downloads   Int      @default(0)
  lastViewed  DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([contentType, contentId])
}

// ===========================================
// COMMENTS & INTERACTIONS
// ===========================================

model Comment {
  id          String   @id @default(cuid())
  content     String
  authorName  String?
  authorEmail String?
  status      String   @default("PENDING")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  blogPostId String?
  blogPost   BlogPost? @relation(fields: [blogPostId], references: [id], onDelete: Cascade)

  parentId String?
  parent   Comment?    @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies  Comment[]   @relation("CommentReplies")
}
